<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLI Reference â€” UPLINK Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/docs.css">
</head>
<body>
  <header class="topbar">
    <a href="/" class="logo">â¬¡ UPLINK DOCS</a>
    <nav class="topnav">
      <a href="/">Home</a>
      <a href="features.html">Features</a>
      <a href="configuration.html">Config</a>
      <a href="https://github.com/mooncompany/uplink" target="_blank">GitHub</a>
    </nav>
    <button class="hamburger" id="hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </header>

  <div class="docs-layout">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <a href="getting-started.html">Installation</a>
        <a href="configuration.html">Configuration</a>
        <a href="cli.html" class="active">CLI Reference</a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Features</div>
        <a href="features.html">Overview</a>
        <a href="voice-chat.html">Voice Chat</a>
        <a href="remote-access.html">Remote Access</a>
        <a href="themes.html">Themes</a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Support</div>
        <a href="troubleshooting.html">Troubleshooting</a>
      </div>
    </aside>

    <main class="docs-content">
      <h1>CLI Reference</h1>
      <p class="subtitle">Control Uplink from the command line â€” start, stop, update, and monitor your server.</p>

      <h2>Overview</h2>
      <p>Uplink ships with a CLI tool called <code>uplink-chat</code>. It's installed automatically when you run <code>npm install -g @mooncompany/uplink-chat</code> or use <code>npx</code>.</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>uplink-chat [command] [options]</code></pre>
      </div>

      <h2>Commands</h2>

      <h3>start</h3>
      <p>Start the Uplink server. This is the default command â€” running <code>uplink-chat</code> with no arguments does the same thing.</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code># Start in foreground (with auto-restart watchdog)
uplink-chat start

# Start in background (daemon mode)
uplink-chat start --detach

# Start without the watchdog (raw server, no auto-restart)
uplink-chat start --no-watchdog

# Start on a custom port
uplink-chat start --port 8080

# Start bound to all interfaces
uplink-chat start --host 0.0.0.0</code></pre>
      </div>

      <p>By default, Uplink starts with a <strong>watchdog</strong> that automatically restarts the server if it crashes. The watchdog uses exponential backoff to prevent restart loops.</p>

      <div class="callout">
        <strong>ðŸ’¡ Tip</strong>
        Use <code>--detach</code> (or <code>-d</code>) to run Uplink in the background. It will keep running even after you close your terminal. Stop it with <code>uplink-chat stop</code>.
      </div>

      <h3>stop</h3>
      <p>Stop a running Uplink server. Handles both foreground and daemon (detached) mode.</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>uplink-chat stop</code></pre>
      </div>

      <p>If Uplink is running with a watchdog, this stops the watchdog first (which also stops the server). PID files are cleaned up automatically.</p>

      <h3>status</h3>
      <p>Check if Uplink is currently running and get details about the process.</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>uplink-chat status</code></pre>
      </div>

      <p>Output includes:</p>
      <ul>
        <li>Whether Uplink is running (and in which mode)</li>
        <li>Watchdog PID and server PID</li>
        <li>Uptime</li>
        <li>Number of automatic restarts (if any)</li>
        <li>Current backoff duration (if the server has been crashing)</li>
      </ul>

      <div class="code-block">
        <div class="code-block-header">
          <span>output</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>â¬¡ Uplink is running (watchdog mode)
  Watchdog PID: 12345
  Server PID:   12350
  Uptime:       2h 15m 30s
  Restarts:     0</code></pre>
      </div>

      <h3>update</h3>
      <p>Update Uplink to the latest version from npm. If the server is running, it will be stopped before the update and restarted automatically afterward.</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>uplink-chat update</code></pre>
      </div>

      <p>The update command:</p>
      <ol>
        <li>Shows the current version</li>
        <li>Stops the server if it's running</li>
        <li>Runs <code>npm update -g @mooncompany/uplink-chat</code></li>
        <li>Displays the version change (e.g. <code>v0.5.1 â†’ v0.5.2</code>)</li>
        <li>Restarts the server if it was running before</li>
      </ol>

      <div class="callout warning">
        <strong>âš  Note</strong>
        If the update fails, Uplink will attempt to restart the previous version so you're never left with a dead server.
      </div>

      <h2>Options</h2>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Option</th><th>Description</th><th>Default</th></tr>
          </thead>
          <tbody>
            <tr><td><code>--port N</code></td><td>Port to listen on</td><td><code>3456</code></td></tr>
            <tr><td><code>--host H</code></td><td>Host/interface to bind to</td><td><code>0.0.0.0</code></td></tr>
            <tr><td><code>--detach</code>, <code>-d</code></td><td>Run in background (daemon mode)</td><td>Off</td></tr>
            <tr><td><code>--no-watchdog</code></td><td>Disable auto-restart watchdog</td><td>Off</td></tr>
            <tr><td><code>-v</code>, <code>--version</code></td><td>Show version number</td><td>â€”</td></tr>
            <tr><td><code>-h</code>, <code>--help</code></td><td>Show help message</td><td>â€”</td></tr>
          </tbody>
        </table>
      </div>

      <h2>Examples</h2>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code># Quick start with npx (no install needed)
npx uplink-chat

# Install globally and run
npm install -g @mooncompany/uplink-chat
uplink-chat

# Run as a background daemon on port 8080
uplink-chat start --detach --port 8080

# Check status
uplink-chat status

# Update to latest version
uplink-chat update

# Stop the server
uplink-chat stop

# Check version
uplink-chat -v</code></pre>
      </div>

      <h2>Watchdog</h2>
      <p>By default, Uplink runs with a watchdog process that monitors the server and restarts it if it crashes. This is useful for long-running deployments where you want Uplink to stay up without manual intervention.</p>

      <p>The watchdog uses <strong>exponential backoff</strong> â€” if the server keeps crashing, restart delays increase to avoid a tight crash loop. The backoff resets after the server runs stably for a period of time.</p>

      <p>You can see the watchdog's state (restart count, backoff duration) with <code>uplink-chat status</code>.</p>

      <p>To disable the watchdog (e.g. during development), use <code>--no-watchdog</code>:</p>

      <div class="code-block">
        <div class="code-block-header">
          <span>bash</span>
          <button class="copy-btn">Copy</button>
        </div>
        <pre><code>uplink-chat start --no-watchdog</code></pre>
      </div>

      <h2>Process Management</h2>
      <p>Uplink stores PID files in its install directory:</p>
      <ul>
        <li><code>.uplink.pid</code> â€” Server process ID</li>
        <li><code>.uplink-watchdog.pid</code> â€” Watchdog process ID</li>
        <li><code>.uplink-watchdog.json</code> â€” Watchdog state (uptime, restart count, backoff)</li>
      </ul>
      <p>These are cleaned up automatically when you run <code>uplink-chat stop</code>. If the server crashes without cleanup, stale PID files are detected and ignored on the next start.</p>

      <div class="docs-footer">
        <p>UPLINK Docs â€” Built by <a href="https://moonco.pro" target="_blank">Moon Company</a>. Open source under MIT.</p>
      </div>
    </main>
  </div>

  <script src="js/docs.js"></script>
</body>
</html>
